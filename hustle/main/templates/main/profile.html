{% extends "base.html" %}

{% block content %}

{% load crispy_forms_tags %}

<div class="row my-4">
    <div class="col-3">
        <div class="card text-center mx-2">
        <div class="card-header bg-brown text-white">
            <h2>Recent Activity</h2>
        </div>
        </div>
    </div>

    <div class="col-6">
        <div class="card mx-2">
            <div class="card-header bg-brown text-white">
                    <h1 class="d-inline-block">Welcome, {{ user.first_name }}!</h1>
	        <span style="float: right" class="badge bg-primary">
                    {% if user.customer_data %}
		    Customer
		    {% elif user.worker_data %}
		        Worker
		    {% elif user.is_superuser %}
		    Owner / Superuser
		    {% endif %}
	        </span>
            </div>
            <div class="card-body justify-content-center">
                {% if edit %}
                    <form method="POST" class="m-2">
                        {% csrf_token %}
		        {% for edit_form in edit_forms %}
		    	    {% if edit_form.as_card %}
			    <div id="{{ edit_form.as_card }}" class="card" style="margin-top: 1em">
			    <div class="card-header">{{ edit_form.card_header }}</div>
			    <div class="card-body">
			    {% endif %}
                            {% for field in edit_form %}
                                <div class="fieldWrapper mb-2">
                                  {{ field|as_crispy_field }}
                                </div>
                            {% endfor %}
			    {% if edit_form.as_card %}
			    </div>
			    </div>
			    {% endif %}
		        {% endfor %}
                        <button class="btn m-2 btn-hustle btn-lg" type="submit">Save</button>
                        <a class="btn m-2 btn-danger btn-lg" type="submit" href="/main">Cancel</a>
                    </form>
                {% else %}
                   <h3>
		       {% for profile_field in profile_fields %}
		       <p>{{ profile_field.0 }}: {{ profile_field.1 }}</p>
		       {% endfor %}
                   </h3>
                    <a class="btn m-2 btn-hustle btn-lg" href="/main/edit">Edit</a>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-3">
        <div class="card mx-2">
            <div class="card-header bg-brown text-white justify-content-center">
                {% if user.data.money < 0 %} <h1 class="text-danger">
                    {% else %}
                    <h1>
                        {% endif %}
                        Balance: ${{ user.data.money }}
                    </h1>
            </div>
            <div>
                <a class="btn m-2 btn-hustle btn-lg" type="submit" href="/main/deposit">Deposit</a>
                <a class="btn m-2 btn-danger btn-lg" type="submit" href="/main/withdraw">Withdraw</a>
            </div>
        </div>
    </div>
</div>
<div class="d-flex justify-content-center">
    {% if deposit %}
    <div class="card w-25 mt-4" style="z-index: 10">
        <div class="card-header bg-hustle-secondary text-white">
            <h1>Deposit</h1>
        </div>
        <div class="m-2">
            <form method="POST" class="m-2">
                {% csrf_token %}
                {% for field in money_form %}
                <div class="fieldWrapper mb-2">
                    {{ field|as_crispy_field }}
                </div>
                {% endfor %}
                <button class="btn m-2 btn-hustle btn-lg" type="submit">Confirm</button>
                <a class="btn m-2 btn-danger btn-lg" type="submit" href="/main">Cancel</a>
            </form>
        </div>
    </div>
    {% elif withdraw %}
    <div class="card w-25 mt-4" style="z-index: 10">
        <div class="card-header bg-hustle-secondary text-white">
            <h1>Withdraw</h1>
        </div>
        <div class="m-2">
            <form method="POST" class="m-2">
                {% csrf_token %}
                {% for field in money_form %}
                <div class="fieldWrapper mb-2">
                    {{ field|as_crispy_field }}
                </div>
                {% endfor %}
                <button class="btn m-2 btn-hustle btn-lg" type="submit">Confirm</button>
                <a class="btn m-2 btn-danger btn-lg" type="submit" href="/main">Cancel</a>
            </form>
        </div>
    </div>
    {% endif %}
</div>
<script type="text/javascript">
    function carry_over(input_event, length, previous, next) {
        let value = input_event.target.value;
        if (value.length == length) {
            if (next) {
                next.focus();
            } else {
                document.activeElement.blur();
            }
        } else if (value.length == 0 && previous) {
            previous.focus();
        } else if (value.length > length && input_event.data) {
            input_event.target.value = input_event.target.value.substr(0, length);
            if (next) {
                next.focus();
            } else {
                document.activeElement.blur();
            }
        }
    }
    {
        let area_code = document.querySelector("input[name='phone_number_area_code']");
        let prefix = document.querySelector("input[name='phone_number_prefix']");
        let line_number = document.querySelector("input[name='phone_number_line_number']");
        area_code.oninput = (e) => {carry_over(e, 3, null, prefix);};
        prefix.oninput = (e) => {carry_over(e, 3, area_code, line_number);};
        line_number.oninput = (e) => {carry_over(e, 4, prefix, null);};
    }
    document.querySelectorAll("#id_state option:first-child").forEach(el => {el.disabled = true;});

</script>
<style>
    input[name^='phone_number_'] {
        width: 5em;
	display: inline;
	background-image: none !important;
	padding-right: inherit !important;
    }
</style>
{% endblock %}
